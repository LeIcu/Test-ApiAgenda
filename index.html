<!DOCTYPE html>
<html lang="ro">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ApiAgenda</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }

      :root {
        --honey: #f5a623;
        --honey-dark: #d4881a;
        --honey-light: #fdf3e3;
        --brown: #3e2a0f;
        --brown-light: #6b4c2a;
        --white: #ffffff;
        --gray: #f0f0f0;
        --gray-dark: #888;
        --danger: #e74c3c;
        --success: #27ae60;
        --card-shadow: 0 4px 20px rgba(0,0,0,0.1);
      }

      body {
        font-family: "Segoe UI", sans-serif;
        background: var(--honey-light);
        color: var(--brown);
        min-height: 100vh;
      }

      /* â”€â”€ AUTH SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      #auth-screen {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, var(--brown) 0%, var(--brown-light) 50%, var(--honey-dark) 100%);
        padding: 1rem;
      }

      .auth-box {
        background: white;
        border-radius: 24px;
        padding: 2.5rem;
        width: 100%;
        max-width: 420px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      }

      .auth-logo {
        text-align: center;
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--brown);
        margin-bottom: 0.3rem;
        letter-spacing: 1px;
      }

      .auth-logo span { color: var(--honey-dark); }

      .auth-tagline {
        text-align: center;
        font-size: 0.85rem;
        color: var(--gray-dark);
        margin-bottom: 2rem;
      }

      .auth-tabs {
        display: flex;
        background: var(--gray);
        border-radius: 12px;
        padding: 4px;
        margin-bottom: 1.8rem;
      }

      .auth-tab {
        flex: 1;
        padding: 0.6rem;
        border: none;
        background: transparent;
        border-radius: 9px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--gray-dark);
        transition: all 0.2s;
      }

      .auth-tab.active {
        background: white;
        color: var(--brown);
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }

      .auth-form { display: flex; flex-direction: column; gap: 1rem; }

      .auth-form-panel { display: none; }
      .auth-form-panel.active { display: flex; flex-direction: column; gap: 1rem; }

      .auth-field {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
      }

      .auth-field label {
        font-size: 0.82rem;
        font-weight: 600;
        color: var(--brown-light);
      }

      .auth-field input {
        padding: 0.75rem 1rem;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        font-size: 0.95rem;
        outline: none;
        transition: border-color 0.2s;
        font-family: inherit;
      }

      .auth-field input:focus { border-color: var(--honey); }

      .auth-btn {
        padding: 0.8rem;
        background: linear-gradient(135deg, var(--honey), var(--honey-dark));
        color: var(--brown);
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
        margin-top: 0.3rem;
      }

      .auth-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(245,166,35,0.4);
      }

      .auth-divider {
        text-align: center;
        font-size: 0.78rem;
        color: var(--gray-dark);
        margin: 0.3rem 0;
        position: relative;
      }

      .auth-divider::before, .auth-divider::after {
        content: "";
        position: absolute;
        top: 50%;
        width: 38%;
        height: 1px;
        background: #e0e0e0;
      }

      .auth-divider::before { left: 0; }
      .auth-divider::after { right: 0; }

      .auth-error {
        background: #fdecea;
        color: var(--danger);
        border-radius: 10px;
        padding: 0.6rem 1rem;
        font-size: 0.85rem;
        display: none;
      }

      .auth-error.show { display: block; }

      .auth-demo {
        text-align: center;
        margin-top: 1rem;
        font-size: 0.8rem;
        color: var(--gray-dark);
      }

      .auth-demo button {
        background: none;
        border: none;
        color: var(--honey-dark);
        font-weight: 600;
        cursor: pointer;
        text-decoration: underline;
        font-size: 0.8rem;
      }

      /* â”€â”€ APP SHELL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      #app-screen { display: none; }
      #app-screen.visible { display: block; }

      header {
        background: linear-gradient(135deg, var(--brown), var(--brown-light));
        color: white;
        padding: 0 2rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 64px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1.4rem;
        font-weight: 700;
        letter-spacing: 1px;
      }

      .logo span { color: var(--honey); }

      .header-right {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      header nav { display: flex; gap: 0.6rem; }

      header nav button {
        background: transparent;
        border: 2px solid rgba(255,255,255,0.3);
        color: white;
        padding: 0.4rem 1rem;
        border-radius: 20px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s;
      }

      header nav button:hover,
      header nav button.active {
        background: var(--honey);
        border-color: var(--honey);
        color: var(--brown);
        font-weight: 600;
      }

      .lang-switcher {
        display: flex;
        gap: 0.3rem;
        background: rgba(255,255,255,0.1);
        border-radius: 20px;
        padding: 0.25rem;
      }

      .lang-btn {
        background: transparent;
        border: none;
        color: rgba(255,255,255,0.7);
        padding: 0.25rem 0.6rem;
        border-radius: 16px;
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: 600;
        transition: all 0.2s;
      }

      .lang-btn.active { background: var(--honey); color: var(--brown); }

      .user-pill {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(255,255,255,0.12);
        border-radius: 20px;
        padding: 0.3rem 0.8rem 0.3rem 0.4rem;
        cursor: pointer;
        transition: background 0.2s;
        border: none;
        color: white;
        font-size: 0.85rem;
      }

      .user-pill:hover { background: rgba(255,255,255,0.2); }

      .user-avatar {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: var(--honey);
        color: var(--brown);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 0.8rem;
      }

      /* â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      main {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
      }

      .view { display: none; }
      .view.active { display: block; }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.2rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: var(--card-shadow);
        display: flex;
        align-items: center;
        gap: 1rem;
        border-left: 5px solid var(--honey);
      }

      .stat-icon { font-size: 2rem; }

      .stat-info h3 {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--brown);
      }

      .stat-info p { font-size: 0.85rem; color: var(--gray-dark); }

      .section-title {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--brown);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .hives-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .search-bar input {
        padding: 0.5rem 1rem;
        border: 2px solid #ddd;
        border-radius: 20px;
        font-size: 0.9rem;
        outline: none;
        transition: border-color 0.2s;
        width: 220px;
      }

      .search-bar input:focus { border-color: var(--honey); }

      .btn {
        padding: 0.6rem 1.4rem;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 600;
        transition: all 0.2s;
      }

      .btn-primary { background: var(--honey); color: var(--brown); }
      .btn-primary:hover { background: var(--honey-dark); transform: translateY(-1px); }
      .btn-danger { background: var(--danger); color: white; }
      .btn-danger:hover { background: #c0392b; }
      .btn-outline { background: transparent; border: 2px solid var(--honey); color: var(--brown); }
      .btn-outline:hover { background: var(--honey); }
      .btn-white { background: transparent; border: 2px solid rgba(255,255,255,0.5); color: white; }
      .btn-white:hover { background: rgba(255,255,255,0.15); }

      .hives-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
      }

      .hive-card {
        background: white;
        border-radius: 16px;
        box-shadow: var(--card-shadow);
        overflow: hidden;
        transition: transform 0.2s, box-shadow 0.2s;
        cursor: pointer;
      }

      .hive-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 30px rgba(0,0,0,0.15);
      }

      .hive-card-header {
        background: linear-gradient(135deg, var(--honey), var(--honey-dark));
        padding: 1.2rem;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
      }

      .hive-name { font-size: 1.1rem; font-weight: 700; color: var(--brown); }
      .hive-id { font-size: 0.75rem; color: var(--brown-light); margin-top: 2px; }

      .hive-status {
        padding: 0.25rem 0.7rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .status-healthy { background: var(--success); color: white; }
      .status-attention { background: #f39c12; color: white; }
      .status-critical { background: var(--danger); color: white; }

      .hive-card-body { padding: 1.2rem; }

      .hive-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.8rem;
        margin-bottom: 1rem;
      }

      .hive-stat {
        text-align: center;
        background: var(--honey-light);
        border-radius: 10px;
        padding: 0.6rem;
      }

      .hive-stat-value { font-size: 1.2rem; font-weight: 700; color: var(--brown); }
      .hive-stat-label { font-size: 0.72rem; color: var(--gray-dark); margin-top: 2px; }

      .hive-card-footer {
        padding: 0.8rem 1.2rem;
        border-top: 1px solid #f0f0f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .hive-date { font-size: 0.78rem; color: var(--gray-dark); }

      .hive-actions { display: flex; gap: 0.4rem; }

      .icon-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1rem;
        padding: 0.3rem;
        border-radius: 8px;
        transition: background 0.2s;
      }

      .icon-btn:hover { background: var(--gray); }

      /* â”€â”€ MODALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .modal-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        z-index: 200;
        align-items: center;
        justify-content: center;
        padding: 1rem;
      }

      .modal-overlay.open { display: flex; }

      .modal {
        background: white;
        border-radius: 20px;
        width: 100%;
        max-width: 560px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      }

      .modal-header {
        padding: 1.5rem;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        background: white;
        border-radius: 20px 20px 0 0;
      }

      .modal-header h2 { font-size: 1.2rem; color: var(--brown); }

      .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--gray-dark);
        line-height: 1;
      }

      .modal-body { padding: 1.5rem; }

      .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      .form-group { display: flex; flex-direction: column; gap: 0.4rem; }
      .form-group.full { grid-column: 1 / -1; }

      .form-group label {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--brown-light);
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        padding: 0.6rem 0.9rem;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 0.9rem;
        outline: none;
        transition: border-color 0.2s;
        font-family: inherit;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus { border-color: var(--honey); }

      .form-group textarea { resize: vertical; min-height: 80px; }

      .modal-footer {
        padding: 1rem 1.5rem;
        border-top: 1px solid #f0f0f0;
        display: flex;
        justify-content: flex-end;
        gap: 0.8rem;
      }

      /* â”€â”€ DETAIL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .detail-header {
        background: linear-gradient(135deg, var(--brown), var(--brown-light));
        color: white;
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .detail-header h1 { font-size: 1.8rem; }
      .detail-header p { opacity: 0.8; margin-top: 0.3rem; }

      .detail-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 1.5rem;
      }

      .detail-card {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: var(--card-shadow);
        margin-bottom: 1.5rem;
      }

      .detail-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
      }

      .detail-stat {
        text-align: center;
        background: var(--honey-light);
        border-radius: 12px;
        padding: 1rem;
        border: 2px solid transparent;
        transition: border-color 0.2s;
      }

      .detail-stat:hover { border-color: var(--honey); }
      .detail-stat-value { font-size: 1.6rem; font-weight: 700; color: var(--brown); }
      .detail-stat-label { font-size: 0.8rem; color: var(--gray-dark); margin-top: 4px; }

      /* â”€â”€ HISTORY TIMELINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .timeline {
        position: relative;
        padding-left: 2rem;
      }

      .timeline::before {
        content: "";
        position: absolute;
        left: 14px;
        top: 0;
        bottom: 0;
        width: 2px;
        background: linear-gradient(to bottom, var(--honey), var(--honey-light));
        border-radius: 2px;
      }

      .timeline-item {
        position: relative;
        margin-bottom: 1.5rem;
      }

      .timeline-item:last-child { margin-bottom: 0; }

      .timeline-dot {
        position: absolute;
        left: -1.85rem;
        top: 6px;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: var(--honey);
        border: 3px solid white;
        box-shadow: 0 0 0 2px var(--honey);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        z-index: 1;
      }

      .timeline-dot.dot-created    { background: var(--success); box-shadow: 0 0 0 2px var(--success); }
      .timeline-dot.dot-inspection { background: var(--honey);   box-shadow: 0 0 0 2px var(--honey); }
      .timeline-dot.dot-updated    { background: #3498db;        box-shadow: 0 0 0 2px #3498db; }
      .timeline-dot.dot-critical   { background: var(--danger);  box-shadow: 0 0 0 2px var(--danger); }

      .timeline-card {
        background: var(--honey-light);
        border-radius: 12px;
        padding: 1rem 1.2rem;
        border-left: 4px solid var(--honey);
        transition: box-shadow 0.2s;
      }

      .timeline-card:hover { box-shadow: var(--card-shadow); }
      .timeline-card.card-created    { border-left-color: var(--success); }
      .timeline-card.card-inspection { border-left-color: var(--honey); }
      .timeline-card.card-updated    { border-left-color: #3498db; }
      .timeline-card.card-critical   { border-left-color: var(--danger); }

      .timeline-top {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      .timeline-action {
        font-weight: 700;
        font-size: 0.95rem;
        color: var(--brown);
      }

      .timeline-date {
        font-size: 0.75rem;
        color: var(--gray-dark);
        white-space: nowrap;
        background: white;
        padding: 2px 8px;
        border-radius: 10px;
      }

      .timeline-note {
        font-size: 0.83rem;
        color: var(--brown-light);
        margin-top: 0.4rem;
        line-height: 1.5;
      }

      .timeline-badges {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
        margin-top: 0.6rem;
      }

      .timeline-badge {
        font-size: 0.72rem;
        font-weight: 600;
        padding: 2px 8px;
        border-radius: 10px;
        background: white;
        color: var(--brown);
        border: 1px solid #e0d0b0;
      }

      .history-filters {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-bottom: 1.2rem;
      }

      .filter-btn {
        padding: 0.3rem 0.9rem;
        border-radius: 20px;
        border: 2px solid #e0e0e0;
        background: white;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        color: var(--gray-dark);
        transition: all 0.2s;
      }

      .filter-btn.active {
        background: var(--honey);
        border-color: var(--honey);
        color: var(--brown);
      }

      .history-stats-bar {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 0.8rem;
        margin-bottom: 1.5rem;
      }

      .hstat {
        background: white;
        border-radius: 10px;
        padding: 0.7rem;
        text-align: center;
        border: 2px solid var(--honey-light);
      }

      .hstat-val   { font-size: 1.3rem; font-weight: 700; color: var(--brown); }
      .hstat-label { font-size: 0.72rem; color: var(--gray-dark); margin-top: 2px; }

      /* â”€â”€ LOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .log-entry {
        display: flex;
        gap: 1rem;
        padding: 0.9rem 0;
        border-bottom: 1px solid #f5f5f5;
        align-items: flex-start;
      }

      .log-entry:last-child { border-bottom: none; }

      .log-icon {
        font-size: 1.2rem;
        width: 36px;
        height: 36px;
        background: var(--honey-light);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .log-content  { flex: 1; }
      .log-action   { font-weight: 600; font-size: 0.9rem; color: var(--brown); }
      .log-note     { font-size: 0.82rem; color: var(--gray-dark); margin-top: 2px; }
      .log-date     { font-size: 0.75rem; color: var(--gray-dark); white-space: nowrap; }

      /* â”€â”€ QR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .qr-modal-inner { max-width: 420px; }

      .qr-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.8rem;
        padding: 1rem 0;
      }

      .qr-label-card {
        border: 3px dashed var(--honey);
        border-radius: 16px;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.6rem;
        background: white;
        width: 100%;
        max-width: 280px;
        position: relative;
      }

      .qr-label-card .qr-logo {
        font-size: 1rem;
        font-weight: 700;
        color: var(--brown);
        letter-spacing: 1px;
      }

      .qr-label-card .qr-logo span { color: var(--honey-dark); }

      .qr-label-card canvas {
        border-radius: 8px;
        border: 4px solid white;
        box-shadow: var(--card-shadow);
      }

      .qr-label-card .qr-hive-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--brown);
        text-align: center;
      }

      .qr-label-card .qr-hive-id {
        font-size: 0.75rem;
        color: var(--gray-dark);
        font-family: monospace;
      }

      .qr-label-card .qr-scan-hint {
        font-size: 0.72rem;
        color: var(--gray-dark);
        text-align: center;
      }

      .qr-label-card .qr-cut-line {
        position: absolute;
        top: -10px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.65rem;
        color: var(--gray-dark);
        background: var(--honey-light);
        padding: 0 0.4rem;
      }

      .qr-actions {
        display: flex;
        gap: 0.8rem;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 0.5rem;
      }

      /* â”€â”€ PRINT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      @media print {
        body * { visibility: hidden; }
        #print-area, #print-area * { visibility: visible; }
        #print-area {
          position: fixed;
          inset: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          background: white;
        }

        .print-label {
          border: 3px solid #333;
          border-radius: 12px;
          padding: 20px;
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 8px;
          width: 260px;
          font-family: "Segoe UI", sans-serif;
        }

        .print-label .p-logo { font-size: 14px; font-weight: 700; color: #3e2a0f; }
        .print-label .p-name { font-size: 16px; font-weight: 700; color: #3e2a0f; text-align: center; }
        .print-label .p-id   { font-size: 10px; color: #888; font-family: monospace; }
        .print-label .p-hint { font-size: 9px; color: #888; text-align: center; }
      }

      #print-area { display: none; }

      .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: var(--gray-dark);
      }

      .empty-state .empty-icon { font-size: 4rem; margin-bottom: 1rem; }
      .empty-state h3 { font-size: 1.2rem; color: var(--brown); margin-bottom: 0.5rem; }

      .toast {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        background: var(--brown);
        color: white;
        padding: 0.8rem 1.5rem;
        border-radius: 12px;
        font-size: 0.9rem;
        z-index: 999;
        transform: translateY(100px);
        opacity: 0;
        transition: all 0.3s;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      }

      .toast.show    { transform: translateY(0); opacity: 1; }
      .toast.success { background: var(--success); }
      .toast.error   { background: var(--danger); }

      .back-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 0.95rem;
        color: var(--brown-light);
        font-weight: 600;
        margin-bottom: 1.2rem;
        padding: 0;
        transition: color 0.2s;
      }

      .back-btn:hover { color: var(--brown); }

      .inspection-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 0.8rem;
        margin-bottom: 1rem;
      }

      .inspection-item {
        background: var(--honey-light);
        border-radius: 10px;
        padding: 0.8rem;
        text-align: center;
      }

      .inspection-item label {
        display: block;
        font-size: 0.75rem;
        color: var(--gray-dark);
        margin-bottom: 0.3rem;
      }

      .inspection-item input {
        width: 100%;
        padding: 0.4rem;
        border: 2px solid #ddd;
        border-radius: 8px;
        text-align: center;
        font-size: 1rem;
        font-weight: 600;
        color: var(--brown);
        outline: none;
      }

      .inspection-item input:focus { border-color: var(--honey); }

      @media (max-width: 700px) {
        .detail-grid { grid-template-columns: 1fr; }
        .form-grid   { grid-template-columns: 1fr; }
        header nav button span.nav-label { display: none; }
      }

      ::-webkit-scrollbar       { width: 6px; }
      ::-webkit-scrollbar-track { background: var(--honey-light); }
      ::-webkit-scrollbar-thumb { background: var(--honey); border-radius: 3px; }
    </style>
  </head>
  <body>

    <!-- â•â• AUTH SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="auth-screen">
      <div class="auth-box">
        <div class="auth-logo">ğŸ¯ <span>Api</span>Agenda</div>
        <div class="auth-tagline">Beehive management for modern beekeepers</div>

        <div class="auth-tabs">
          <button class="auth-tab active" onclick="switchAuthTab('login')">Sign In</button>
          <button class="auth-tab" onclick="switchAuthTab('register')">Create Account</button>
        </div>

        <div id="auth-error" class="auth-error"></div>

        <!-- LOGIN -->
        <div class="auth-form-panel active" id="panel-login">
          <div class="auth-field">
            <label>Email</label>
            <input type="email" id="login-email" placeholder="you@example.com" />
          </div>
          <div class="auth-field">
            <label>Password</label>
            <input type="password" id="login-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
              onkeydown="if(event.key==='Enter') doLogin()" />
          </div>
          <button class="auth-btn" onclick="doLogin()">Sign In â†’</button>
        </div>

        <!-- REGISTER -->
        <div class="auth-form-panel" id="panel-register">
          <div class="auth-field">
            <label>Full Name</label>
            <input type="text" id="reg-name" placeholder="Ion Popescu" />
          </div>
          <div class="auth-field">
            <label>Email</label>
            <input type="email" id="reg-email" placeholder="you@example.com" />
          </div>
          <div class="auth-field">
            <label>Password</label>
            <input type="password" id="reg-password" placeholder="Min. 6 characters"
              onkeydown="if(event.key==='Enter') doRegister()" />
          </div>
          <button class="auth-btn" onclick="doRegister()">Create Account â†’</button>
        </div>

        <div class="auth-divider">or</div>
        <div class="auth-demo">
          <button onclick="demoLogin()">ğŸ Try demo account (no sign-up needed)</button>
        </div>
      </div>
    </div>

    <!-- â•â• APP SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="app-screen">
      <header>
        <div class="logo">ğŸ¯ <span>Api</span>Agenda</div>
        <div class="header-right">
          <nav>
            <button class="active" onclick="showView('dashboard')">
              ğŸ“Š <span class="nav-label" data-t="nav_dashboard">Panou</span>
            </button>
            <button onclick="showView('hives')">
              ğŸ <span class="nav-label" data-t="nav_hives">Stupi</span>
            </button>
          </nav>
          <div class="lang-switcher">
            <button class="lang-btn active" onclick="setLang('ro')">RO</button>
            <button class="lang-btn" onclick="setLang('en')">EN</button>
          </div>
          <button class="user-pill" onclick="showUserMenu()">
            <div class="user-avatar" id="user-avatar">?</div>
            <span id="user-name-display">User</span>
            â–¾
          </button>
        </div>
      </header>

      <main>
        <!-- DASHBOARD -->
        <div class="view active" id="view-dashboard">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">ğŸ </div>
              <div class="stat-info">
                <h3 id="stat-total">0</h3>
                <p data-t="stat_total">Total Stupi</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">âœ…</div>
              <div class="stat-info">
                <h3 id="stat-healthy">0</h3>
                <p data-t="stat_healthy">Stupi SÄƒnÄƒtoÈ™i</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">ğŸ¯</div>
              <div class="stat-info">
                <h3 id="stat-honey">0 kg</h3>
                <p data-t="stat_honey">Miere TotalÄƒ</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">âš ï¸</div>
              <div class="stat-info">
                <h3 id="stat-attention">0</h3>
                <p data-t="stat_attention">NecesitÄƒ AtenÈ›ie</p>
              </div>
            </div>
          </div>
          <div class="section-title">ğŸ• <span data-t="recent_activity">Activitate RecentÄƒ</span></div>
          <div class="detail-card">
            <div id="recent-log"></div>
          </div>
        </div>

        <!-- HIVES -->
        <div class="view" id="view-hives">
          <div class="hives-header">
            <div class="section-title" style="margin:0">
              ğŸ <span data-t="my_hives">Stupii Mei</span>
            </div>
            <div style="display:flex;gap:0.8rem;align-items:center">
              <div class="search-bar">
                <input type="text" id="search-input"
                  placeholder="ğŸ” CautÄƒ stupi..." oninput="renderHives()" />
              </div>
              <button class="btn btn-primary" onclick="openAddModal()">
                + <span data-t="add_hive">AdaugÄƒ Stup</span>
              </button>
            </div>
          </div>
          <div class="hives-grid" id="hives-grid"></div>
        </div>

        <!-- DETAIL -->
        <div class="view" id="view-detail">
          <button class="back-btn" onclick="showView('hives')">
            â† <span data-t="back_hives">Ãnapoi la Stupi</span>
          </button>
          <div class="detail-header">
            <div>
              <h1 id="detail-name"></h1>
              <p id="detail-location"></p>
              <p id="detail-queen" style="margin-top:0.3rem"></p>
            </div>
            <div style="display:flex;gap:0.6rem;flex-wrap:wrap">
              <button class="btn btn-primary" onclick="openQRModal()">
                ğŸ“± <span data-t="qr_code">Cod QR</span>
              </button>
              <button class="btn btn-white" onclick="openInspectionModal()">
                + <span data-t="inspection">InspecÈ›ie</span>
              </button>
              <button class="btn btn-white" onclick="openEditModal(currentHiveId)">
                âœï¸ <span data-t="edit">EditeazÄƒ</span>
              </button>
            </div>
          </div>

          <div class="detail-grid">
            <div>
              <div class="detail-card">
                <div class="section-title">ğŸ“Š <span data-t="current_stats">Statistici Curente</span></div>
                <div class="detail-stats" id="detail-stats"></div>
              </div>

              <div class="detail-card">
                <div class="section-title">ğŸ“œ <span data-t="history">Istoric Complet</span></div>
                <div class="history-stats-bar" id="history-stats-bar"></div>
                <div class="history-filters">
                  <button class="filter-btn active" onclick="filterHistory('all', this)"
                    data-t="filter_all">Toate</button>
                  <button class="filter-btn" onclick="filterHistory('inspection', this)"
                    data-t="filter_inspection">InspecÈ›ii</button>
                  <button class="filter-btn" onclick="filterHistory('updated', this)"
                    data-t="filter_updated">ActualizÄƒri</button>
                  <button class="filter-btn" onclick="filterHistory('created', this)"
                    data-t="filter_created">Creare</button>
                </div>
                <div class="timeline" id="history-timeline"></div>
              </div>
            </div>

            <div>
              <div class="detail-card">
                <div class="section-title">â„¹ï¸ <span data-t="info">InformaÈ›ii</span></div>
                <div id="detail-info"></div>
              </div>
              <div class="detail-card" style="text-align:center">
                <div class="section-title" style="justify-content:center">
                  ğŸ“± <span data-t="qr_code">Cod QR</span>
                </div>
                <div id="detail-qr-mini" style="margin-top:0.5rem"></div>
                <button class="btn btn-outline"
                  style="margin-top:0.8rem;font-size:0.8rem" onclick="openQRModal()">
                  <span data-t="print_qr">PrinteazÄƒ / DescarcÄƒ</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- ADD/EDIT HIVE MODAL -->
    <div class="modal-overlay" id="hive-modal">
      <div class="modal">
        <div class="modal-header">
          <h2 id="hive-modal-title" data-t="add_hive_title">AdaugÄƒ Stup Nou</h2>
          <button class="modal-close" onclick="closeHiveModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="form-grid">
            <div class="form-group">
              <label data-t="f_name">Nume Stup *</label>
              <input type="text" id="f-name" placeholder="ex: Stupul Alpha" />
            </div>
            <div class="form-group">
              <label data-t="f_location">LocaÈ›ie</label>
              <input type="text" id="f-location" placeholder="ex: CÃ¢mpul de Nord" />
            </div>
            <div class="form-group">
              <label data-t="f_status">Status</label>
              <select id="f-status">
                <option value="healthy">âœ… SÄƒnÄƒtos</option>
                <option value="attention">âš ï¸ NecesitÄƒ AtenÈ›ie</option>
                <option value="critical">ğŸš¨ Critic</option>
              </select>
            </div>
            <div class="form-group">
              <label data-t="f_queen_age">VÃ¢rsta MÄƒtcii (ani)</label>
              <input type="number" id="f-queen-age" placeholder="ex: 1" min="0" />
            </div>
            <div class="form-group">
              <label data-t="f_queen_type">Rasa MÄƒtcii</label>
              <input type="text" id="f-queen-type" placeholder="ex: Carniolan" />
            </div>
            <div class="form-group">
              <label data-t="f_frames">Total Rame</label>
              <input type="number" id="f-frames" placeholder="ex: 10" min="0" />
            </div>
            <div class="form-group">
              <label data-t="f_honey_frames">Rame cu Miere</label>
              <input type="number" id="f-honey-frames" placeholder="ex: 4" min="0" />
            </div>
            <div class="form-group">
              <label data-t="f_brood_frames">Rame cu Puiet</label>
              <input type="number" id="f-brood-frames" placeholder="ex: 6" min="0" />
            </div>
            <div class="form-group">
              <label data-t="f_honey">Miere ProdusÄƒ Total (kg)</label>
              <input type="number" id="f-honey" placeholder="ex: 12.5" min="0" step="0.1" />
            </div>
            <div class="form-group">
              <label data-t="f_population">PopulaÈ›ie EstimatÄƒ</label>
              <select id="f-population">
                <option value="ScÄƒzutÄƒ">ScÄƒzutÄƒ</option>
                <option value="Medie" selected>Medie</option>
                <option value="RidicatÄƒ">RidicatÄƒ</option>
                <option value="Foarte RidicatÄƒ">Foarte RidicatÄƒ</option>
              </select>
            </div>
            <div class="form-group full">
              <label data-t="f_notes">ObservaÈ›ii</label>
              <textarea id="f-notes" placeholder="Orice observaÈ›ii..."></textarea>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" onclick="closeHiveModal()">
            <span data-t="cancel">AnuleazÄƒ</span>
          </button>
          <button class="btn btn-primary" onclick="saveHive()">
            <span data-t="save">SalveazÄƒ</span>
          </button>
        </div>
      </div>
    </div>

    <!-- INSPECTION MODAL -->
    <div class="modal-overlay" id="inspection-modal">
      <div class="modal">
        <div class="modal-header">
          <h2 data-t="new_inspection">ğŸ“‹ InspecÈ›ie NouÄƒ</h2>
          <button class="modal-close" onclick="closeInspectionModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="inspection-grid">
            <div class="inspection-item">
              <label data-t="i_frames">ğŸ–¼ï¸ Total Rame</label>
              <input type="number" id="i-frames" min="0" placeholder="10" />
            </div>
            <div class="inspection-item">
              <label data-t="i_honey_frames">ğŸ¯ Rame Miere</label>
              <input type="number" id="i-honey-frames" min="0" placeholder="4" />
            </div>
            <div class="inspection-item">
              <label data-t="i_brood_frames">ğŸ£ Rame Puiet</label>
              <input type="number" id="i-brood-frames" min="0" placeholder="6" />
            </div>
            <div class="inspection-item">
              <label data-t="i_honey_kg">ğŸ¯ Miere (kg)</label>
              <input type="number" id="i-honey" min="0" step="0.1" placeholder="0" />
            </div>
          </div>
          <div class="form-grid" style="margin-top:1rem">
            <div class="form-group">
              <label data-t="i_queen">MatcÄƒ VÄƒzutÄƒ?</label>
              <select id="i-queen">
                <option value="Da">Da âœ…</option>
                <option value="Nu">Nu âŒ</option>
                <option value="Nesigur">Nesigur ğŸ¤”</option>
              </select>
            </div>
            <div class="form-group">
              <label data-t="i_temper">Temperament</label>
              <select id="i-temper">
                <option value="Calm">Calm ğŸ˜Š</option>
                <option value="Moderat">Moderat ğŸ˜</option>
                <option value="Agresiv">Agresiv ğŸ˜ </option>
              </select>
            </div>
            <div class="form-group">
              <label data-t="i_status">ActualizeazÄƒ Status</label>
              <select id="i-status">
                <option value="healthy">âœ… SÄƒnÄƒtos</option>
                <option value="attention">âš ï¸ NecesitÄƒ AtenÈ›ie</option>
                <option value="critical">ğŸš¨ Critic</option>
              </select>
            </div>
            <div class="form-group">
              <label data-t="i_varroa">Nivel Varroa</label>
              <select id="i-varroa">
                <option value="Absent">Absent</option>
                <option value="ScÄƒzut">ScÄƒzut</option>
                <option value="Mediu">Mediu</option>
                <option value="Ridicat">Ridicat</option>
              </select>
            </div>
            <div class="form-group full">
              <label data-t="f_notes">ObservaÈ›ii</label>
              <textarea id="i-notes" placeholder="ObservaÈ›ii din aceastÄƒ inspecÈ›ie..."></textarea>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" onclick="closeInspectionModal()">
            <span data-t="cancel">AnuleazÄƒ</span>
          </button>
          <button class="btn btn-primary" onclick="saveInspection()">
            <span data-t="save_inspection">SalveazÄƒ InspecÈ›ia</span>
          </button>
        </div>
      </div>
    </div>

    <!-- QR MODAL -->
    <div class="modal-overlay" id="qr-modal">
      <div class="modal qr-modal-inner">
        <div class="modal-header">
          <h2>ğŸ“± <span data-t="qr_title">Cod QR Stup</span></h2>
          <button class="modal-close" onclick="closeQRModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="qr-container">
            <div class="qr-label-card" id="qr-label-card">
              <div class="qr-cut-line" data-t="cut_here">âœ‚ taie aici</div>
              <div class="qr-logo">ğŸ¯ <span>Api</span>Agenda</div>
              <canvas id="qr-canvas"></canvas>
              <div class="qr-hive-title" id="qr-hive-name-display"></div>
              <div class="qr-hive-id" id="qr-hive-id-display"></div>
              <div class="qr-scan-hint" data-t="scan_hint">ScaneazÄƒ pentru a vedea detaliile stupului</div>
            </div>
            <div class="qr-actions">
              <button class="btn btn-primary" onclick="printQR()">
                ğŸ–¨ï¸ <span data-t="print">PrinteazÄƒ</span>
              </button>
              <button class="btn btn-outline" onclick="downloadQR()">
                â¬‡ï¸ <span data-t="download">DescarcÄƒ PNG</span>
              </button>
            </div>
            <p style="font-size:0.78rem;color:var(--gray-dark);text-align:center" data-t="qr_hint">
              PrinteazÄƒ È™i lipeÈ™te eticheta direct pe stupul fizic.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- USER MENU MODAL -->
    <div class="modal-overlay" id="user-modal">
      <div class="modal" style="max-width:340px">
        <div class="modal-header">
          <h2>ğŸ‘¤ Account</h2>
          <button class="modal-close" onclick="closeUserMenu()">Ã—</button>
        </div>
        <div class="modal-body"
          style="display:flex;flex-direction:column;gap:1rem;align-items:center;text-align:center">
          <div style="width:64px;height:64px;border-radius:50%;background:var(--honey);
            display:flex;align-items:center;justify-content:center;
            font-size:1.8rem;font-weight:700;color:var(--brown)" id="modal-avatar">?</div>
          <div>
            <div style="font-size:1.1rem;font-weight:700" id="modal-user-name">â€”</div>
            <div style="font-size:0.85rem;color:var(--gray-dark)" id="modal-user-email">â€”</div>
          </div>
          <div style="background:var(--honey-light);border-radius:12px;padding:0.8rem 1.2rem;
            width:100%;font-size:0.85rem;color:var(--brown-light)">
            ğŸ—„ï¸ Data stored locally on this device
          </div>
          <button class="btn btn-danger" style="width:100%" onclick="doLogout()">
            ğŸšª Sign Out
          </button>
        </div>
      </div>
    </div>

    <div id="print-area">
      <div class="print-label" id="print-label-inner"></div>
    </div>

    <div class="toast" id="toast"></div>
    <script>
      // â•â• TRANSLATIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const T = {
        ro: {
          nav_dashboard:"Panou",nav_hives:"Stupi",stat_total:"Total Stupi",
          stat_healthy:"Stupi SÄƒnÄƒtoÈ™i",stat_honey:"Miere TotalÄƒ",
          stat_attention:"NecesitÄƒ AtenÈ›ie",recent_activity:"Activitate RecentÄƒ",
          my_hives:"Stupii Mei",add_hive:"AdaugÄƒ Stup",add_hive_title:"AdaugÄƒ Stup Nou",
          back_hives:"Ãnapoi la Stupi",qr_code:"Cod QR",inspection:"InspecÈ›ie",
          edit:"EditeazÄƒ",current_stats:"Statistici Curente",history:"Istoric Complet",
          filter_all:"Toate",filter_inspection:"InspecÈ›ii",filter_updated:"ActualizÄƒri",
          filter_created:"Creare",info:"InformaÈ›ii",print_qr:"PrinteazÄƒ / DescarcÄƒ",
          f_name:"Nume Stup *",f_location:"LocaÈ›ie",f_status:"Status",
          f_queen_age:"VÃ¢rsta MÄƒtcii (ani)",f_queen_type:"Rasa MÄƒtcii",
          f_frames:"Total Rame",f_honey_frames:"Rame cu Miere",
          f_brood_frames:"Rame cu Puiet",f_honey:"Miere ProdusÄƒ Total (kg)",
          f_population:"PopulaÈ›ie EstimatÄƒ",f_notes:"ObservaÈ›ii",
          cancel:"AnuleazÄƒ",save:"SalveazÄƒ",new_inspection:"ğŸ“‹ InspecÈ›ie NouÄƒ",
          i_frames:"ğŸ–¼ï¸ Total Rame",i_honey_frames:"ğŸ¯ Rame Miere",
          i_brood_frames:"ğŸ£ Rame Puiet",i_honey_kg:"ğŸ¯ Miere (kg)",
          i_queen:"MatcÄƒ VÄƒzutÄƒ?",i_temper:"Temperament",
          i_status:"ActualizeazÄƒ Status",i_varroa:"Nivel Varroa",
          save_inspection:"SalveazÄƒ InspecÈ›ia",qr_title:"Cod QR Stup",
          cut_here:"âœ‚ taie aici",scan_hint:"ScaneazÄƒ pentru a vedea detaliile stupului",
          print:"PrinteazÄƒ",download:"DescarcÄƒ PNG",
          qr_hint:"PrinteazÄƒ È™i lipeÈ™te eticheta direct pe stupul fizic.",
          ev_created:"Stup Creat",ev_inspection:"InspecÈ›ie",ev_updated:"Actualizat",
          hstat_events:"Total Evenimente",hstat_inspections:"InspecÈ›ii",
          hstat_honey:"Miere (kg)",hstat_days:"Zile Active",hstat_last:"Ultima InspecÈ›ie",
          no_history:"Niciun eveniment Ã®nregistrat.",no_hives_title:"Niciun stup Ã®ncÄƒ",
          no_hives_sub:"AdaugÄƒ primul tÄƒu stup pentru a Ã®ncepe.",
          no_activity:"Nicio activitate recentÄƒ.",
          toast_added:"Stup adÄƒugat!",toast_updated:"Stup actualizat!",
          toast_inspection:"InspecÈ›ie salvatÄƒ!",toast_deleted:"Stup È™ters.",
          confirm_delete:"EÈ™ti sigur cÄƒ vrei sÄƒ È™tergi acest stup?",
          lbl_location:"LocaÈ›ie",lbl_frames:"Total Rame",lbl_honey:"Miere TotalÄƒ",
          lbl_population:"PopulaÈ›ie",lbl_queen:"MÄƒtcÄƒ",lbl_queen_type:"RasÄƒ MÄƒtcÄƒ",
          lbl_status:"Status",lbl_last:"Ultima InspecÈ›ie",lbl_notes:"ObservaÈ›ii",
          never:"NiciodatÄƒ",unknown:"Necunoscut",years:"ani"
        },
        en: {
          nav_dashboard:"Dashboard",nav_hives:"Hives",stat_total:"Total Hives",
          stat_healthy:"Healthy Hives",stat_honey:"Total Honey",
          stat_attention:"Need Attention",recent_activity:"Recent Activity",
          my_hives:"My Hives",add_hive:"Add Hive",add_hive_title:"Add New Hive",
          back_hives:"Back to Hives",qr_code:"QR Code",inspection:"Inspection",
          edit:"Edit",current_stats:"Current Stats",history:"Full History",
          filter_all:"All",filter_inspection:"Inspections",filter_updated:"Updates",
          filter_created:"Created",info:"Information",print_qr:"Print / Download",
          f_name:"Hive Name *",f_location:"Location",f_status:"Status",
          f_queen_age:"Queen Age (years)",f_queen_type:"Queen Breed",
          f_frames:"Total Frames",f_honey_frames:"Honey Frames",
          f_brood_frames:"Brood Frames",f_honey:"Total Honey Produced (kg)",
          f_population:"Estimated Population",f_notes:"Notes",
          cancel:"Cancel",save:"Save",new_inspection:"ğŸ“‹ New Inspection",
          i_frames:"ğŸ–¼ï¸ Total Frames",i_honey_frames:"ğŸ¯ Honey Frames",
          i_brood_frames:"ğŸ£ Brood Frames",i_honey_kg:"ğŸ¯ Honey (kg)",
          i_queen:"Queen Spotted?",i_temper:"Temperament",
          i_status:"Update Status",i_varroa:"Varroa Level",
          save_inspection:"Save Inspection",qr_title:"Hive QR Code",
          cut_here:"âœ‚ cut here",scan_hint:"Scan to view hive details",
          print:"Print",download:"Download PNG",
          qr_hint:"Print and stick the label directly on the physical hive.",
          ev_created:"Hive Created",ev_inspection:"Inspection",ev_updated:"Updated",
          hstat_events:"Total Events",hstat_inspections:"Inspections",
          hstat_honey:"Honey (kg)",hstat_days:"Days Active",hstat_last:"Last Inspection",
          no_history:"No events recorded yet.",no_hives_title:"No hives yet",
          no_hives_sub:"Add your first hive to get started.",
          no_activity:"No recent activity.",
          toast_added:"Hive added!",toast_updated:"Hive updated!",
          toast_inspection:"Inspection saved!",toast_deleted:"Hive deleted.",
          confirm_delete:"Are you sure you want to delete this hive?",
          lbl_location:"Location",lbl_frames:"Total Frames",lbl_honey:"Total Honey",
          lbl_population:"Population",lbl_queen:"Queen",lbl_queen_type:"Queen Breed",
          lbl_status:"Status",lbl_last:"Last Inspection",lbl_notes:"Notes",
          never:"Never",unknown:"Unknown",years:"yrs"
        }
      };

      // â•â• STATE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      let lang = "ro";
      let currentUser = null;
      let hives = [];
      let currentHiveId = null;
      let editingHiveId = null;
      let historyFilter = "all";

      // â•â• AUTH â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function usersDb() {
        return JSON.parse(localStorage.getItem("aa_users") || "{}");
      }
      function saveUsersDb(db) {
        localStorage.setItem("aa_users", JSON.stringify(db));
      }
      function hivesKey(email) {
        return "aa_hives_" + email;
      }
      function loadHives() {
        if (!currentUser) return;
        hives = JSON.parse(localStorage.getItem(hivesKey(currentUser.email)) || "[]");
      }
      function saveHives() {
        if (!currentUser) return;
        localStorage.setItem(hivesKey(currentUser.email), JSON.stringify(hives));
      }

      function switchAuthTab(tab) {
        document.querySelectorAll(".auth-tab").forEach((b, i) => {
          b.classList.toggle("active", (i === 0 && tab === "login") || (i === 1 && tab === "register"));
        });
        document.getElementById("panel-login").classList.toggle("active", tab === "login");
        document.getElementById("panel-register").classList.toggle("active", tab === "register");
        hideAuthError();
      }

      function showAuthError(msg) {
        const el = document.getElementById("auth-error");
        el.textContent = msg;
        el.classList.add("show");
      }
      function hideAuthError() {
        document.getElementById("auth-error").classList.remove("show");
      }

      function doLogin() {
        const email = document.getElementById("login-email").value.trim().toLowerCase();
        const pass  = document.getElementById("login-password").value;
        if (!email || !pass) return showAuthError("Please fill in all fields.");
        const db = usersDb();
        if (!db[email] || db[email].password !== pass)
          return showAuthError("Invalid email or password.");
        currentUser = { email, name: db[email].name };
        enterApp();
      }

      function doRegister() {
        const name  = document.getElementById("reg-name").value.trim();
        const email = document.getElementById("reg-email").value.trim().toLowerCase();
        const pass  = document.getElementById("reg-password").value;
        if (!name || !email || !pass) return showAuthError("Please fill in all fields.");
        if (pass.length < 6) return showAuthError("Password must be at least 6 characters.");
        const db = usersDb();
        if (db[email]) return showAuthError("An account with this email already exists.");
        db[email] = { name, password: pass };
        saveUsersDb(db);
        currentUser = { email, name };
        enterApp();
      }

      function demoLogin() {
        const email = "demo@apiagenda.ro";
        const db = usersDb();
        if (!db[email]) {
          db[email] = { name: "Demo Beekeeper", password: "demo123" };
          saveUsersDb(db);
          currentUser = { email, name: "Demo Beekeeper" };
          loadHives();
          if (hives.length === 0) seedDemoData();
        } else {
          currentUser = { email, name: "Demo Beekeeper" };
        }
        enterApp();
      }

      function doLogout() {
        currentUser = null;
        hives = [];
        currentHiveId = null;
        closeUserMenu();
        document.getElementById("app-screen").classList.remove("visible");
        document.getElementById("auth-screen").style.display = "flex";
        document.getElementById("login-email").value = "";
        document.getElementById("login-password").value = "";
      }

      function enterApp() {
        localStorage.setItem("aa_session", JSON.stringify(currentUser));
        loadHives();
        document.getElementById("auth-screen").style.display = "none";
        document.getElementById("app-screen").classList.add("visible");
        const initials = currentUser.name.split(" ").map(w => w[0]).join("").toUpperCase().slice(0,2);
        document.getElementById("user-avatar").textContent = initials;
        document.getElementById("user-name-display").textContent = currentUser.name.split(" ")[0];
        document.getElementById("modal-avatar").textContent = initials;
        document.getElementById("modal-user-name").textContent = currentUser.name;
        document.getElementById("modal-user-email").textContent = currentUser.email;
        showView("dashboard");
        applyLang();
      }

      function showUserMenu() {
        document.getElementById("user-modal").classList.add("open");
      }
      function closeUserMenu() {
        document.getElementById("user-modal").classList.remove("open");
      }

      // â•â• DEMO SEED â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function seedDemoData() {
        const now = Date.now();
        const day = 86400000;
        hives = [
          {
            id: "HIVE-001", name: "Stupul Alpha", location: "CÃ¢mpul de Nord",
            status: "healthy", queenAge: 1, queenType: "Carniolan",
            frames: 10, honeyFrames: 4, broodFrames: 6,
            honeyTotal: 18.5, population: "RidicatÄƒ", notes: "Familie puternicÄƒ, matcÄƒ activÄƒ.",
            created: now - 90*day,
            history: [
              { type:"created", date: now - 90*day, note:"Stup Ã®nregistrat Ã®n ApiAgenda." },
              { type:"inspection", date: now - 60*day, frames:8, honeyFrames:2, broodFrames:5,
                honey:5, queen:"Da", temper:"Calm", varroa:"Absent", status:"healthy",
                note:"Totul Ã®n regulÄƒ. Familie Ã®n creÈ™tere." },
              { type:"updated", date: now - 45*day, note:"AdÄƒugat corp suplimentar." },
              { type:"inspection", date: now - 20*day, frames:10, honeyFrames:4, broodFrames:6,
                honey:13.5, queen:"Da", temper:"Calm", varroa:"ScÄƒzut", status:"healthy",
                note:"RecoltÄƒ bunÄƒ. Varroa scÄƒzut, tratat preventiv." },
            ]
          },
          {
            id: "HIVE-002", name: "Stupul Beta", location: "Livada de Vest",
            status: "attention", queenAge: 3, queenType: "Buckfast",
            frames: 8, honeyFrames: 3, broodFrames: 3,
            honeyTotal: 9.0, population: "Medie", notes: "MatcÄƒ Ã®mbÄƒtrÃ¢nitÄƒ, necesitÄƒ Ã®nlocuire.",
            created: now - 180*day,
            history: [
              { type:"created", date: now - 180*day, note:"Stup Ã®nregistrat." },
              { type:"inspection", date: now - 90*day, frames:10, honeyFrames:4, broodFrames:6,
                honey:6, queen:"Da", temper:"Moderat", varroa:"ScÄƒzut", status:"healthy",
                note:"Stup sÄƒnÄƒtos dar agitaÈ›ie observatÄƒ." },
              { type:"inspection", date: now - 30*day, frames:8, honeyFrames:3, broodFrames:3,
                honey:3, queen:"Nesigur", temper:"Agresiv", varroa:"Mediu", status:"attention",
                note:"MatcÄƒ nevÄƒzutÄƒ. PopulaÈ›ie Ã®n scÄƒdere. Planificat tratament varroa." },
            ]
          },
          {
            id: "HIVE-003", name: "Stupul Gamma", location: "GrÄƒdina din Spate",
            status: "healthy", queenAge: 1, queenType: "LocalÄƒ",
            frames: 12, honeyFrames: 6, broodFrames: 6,
            honeyTotal: 24.0, population: "Foarte RidicatÄƒ", notes: "Cea mai productivÄƒ familie.",
            created: now - 365*day,
            history: [
              { type:"created", date: now - 365*day, note:"Prima familie din stupinÄƒ." },
              { type:"inspection", date: now - 200*day, frames:10, honeyFrames:4, broodFrames:6,
                honey:10, queen:"Da", temper:"Calm", varroa:"Absent", status:"healthy",
                note:"Excelent. Familie model." },
              { type:"updated", date: now - 150*day, note:"Extins cu al doilea corp." },
              { type:"inspection", date: now - 90*day, frames:12, honeyFrames:5, broodFrames:7,
                honey:18, queen:"Da", temper:"Calm", varroa:"Absent", status:"healthy",
                note:"RecoltÄƒ record! 8kg Ã®n plus faÈ›Äƒ de ultima inspecÈ›ie." },
              { type:"inspection", date: now - 15*day, frames:12, honeyFrames:6, broodFrames:6,
                honey:24, queen:"Da", temper:"Calm", varroa:"Absent", status:"healthy",
                note:"PregÄƒtit pentru iarnÄƒ. Rezerve bune." },
            ]
          }
        ];
        saveHives();
      }

      // â•â• LANG â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function setLang(l) {
        lang = l;
        document.querySelectorAll(".lang-btn").forEach(b => {
          b.classList.toggle("active", b.textContent === l.toUpperCase());
        });
        applyLang();
      }

      function t(key) {
        return (T[lang] && T[lang][key]) || (T.en[key]) || key;
      }

      function applyLang() {
        document.querySelectorAll("[data-t]").forEach(el => {
          el.textContent = t(el.dataset.t);
        });
        document.getElementById("search-input").placeholder =
          lang === "ro" ? "ğŸ” CautÄƒ stupi..." : "ğŸ” Search hives...";
      }

      // â•â• VIEWS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function showView(name) {
        document.querySelectorAll(".view").forEach(v => v.classList.remove("active"));
        document.getElementById("view-" + name).classList.add("active");
        document.querySelectorAll("header nav button").forEach((b, i) => {
          b.classList.toggle("active",
            (i === 0 && name === "dashboard") || (i === 1 && (name === "hives" || name === "detail"))
          );
        });
        if (name === "dashboard") renderDashboard();
        if (name === "hives")     renderHives();
        if (name === "detail")    renderDetail();
      }

      // â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function renderDashboard() {
        const total    = hives.length;
        const healthy  = hives.filter(h => h.status === "healthy").length;
        const honeySum = hives.reduce((s, h) => s + (parseFloat(h.honeyTotal) || 0), 0);
        const attn     = hives.filter(h => h.status !== "healthy").length;
        document.getElementById("stat-total").textContent     = total;
        document.getElementById("stat-healthy").textContent   = healthy;
        document.getElementById("stat-honey").textContent     = honeySum.toFixed(1) + " kg";
        document.getElementById("stat-attention").textContent = attn;

        // Recent activity: gather all history events, sort newest first
        const events = [];
        hives.forEach(h => {
          (h.history || []).forEach(ev => {
            events.push({ hive: h, ev });
          });
        });
        events.sort((a, b) => b.ev.date - a.ev.date);

        const logEl = document.getElementById("recent-log");
        if (events.length === 0) {
          logEl.innerHTML = `<p style="color:var(--gray-dark);text-align:center;padding:2rem">${t("no_activity")}</p>`;
          return;
        }

        const icons = { created:"ğŸŒ±", inspection:"ğŸ”", updated:"âœï¸", critical:"ğŸš¨" };
        logEl.innerHTML = events.slice(0, 12).map(({ hive, ev }) => `
          <div class="log-entry" onclick="openDetail('${hive.id}')" style="cursor:pointer">
            <div class="log-icon">${icons[ev.type] || "ğŸ“Œ"}</div>
            <div class="log-content">
              <div class="log-action">${hive.name} â€” ${t("ev_" + ev.type)}</div>
              <div class="log-note">${ev.note || ""}</div>
            </div>
            <div class="log-date">${fmtDate(ev.date)}</div>
          </div>
        `).join("");
      }

      // â•â• HIVES LIST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function renderHives() {
        const q = (document.getElementById("search-input").value || "").toLowerCase();
        const filtered = hives.filter(h =>
          h.name.toLowerCase().includes(q) ||
          (h.location || "").toLowerCase().includes(q)
        );
        const grid = document.getElementById("hives-grid");
        if (filtered.length === 0) {
          grid.innerHTML = `
            <div class="empty-state" style="grid-column:1/-1">
              <div class="empty-icon">ğŸ</div>
              <h3>${t("no_hives_title")}</h3>
              <p>${t("no_hives_sub")}</p>
            </div>`;
          return;
        }
        grid.innerHTML = filtered.map(h => hiveCard(h)).join("");
      }

      function hiveCard(h) {
        const lastInsp = [...(h.history || [])].filter(e => e.type === "inspection").pop();
        const lastDate = lastInsp ? fmtDate(lastInsp.date) : t("never");
        const statusLabel = {
          healthy:   lang === "ro" ? "SÄƒnÄƒtos"         : "Healthy",
          attention: lang === "ro" ? "NecesitÄƒ AtenÈ›ie": "Needs Attention",
          critical:  lang === "ro" ? "Critic"          : "Critical",
        }[h.status] || h.status;

        return `
          <div class="hive-card" onclick="openDetail('${h.id}')">
            <div class="hive-card-header">
              <div>
                <div class="hive-name">${h.name}</div>
                <div class="hive-id">${h.id}</div>
              </div>
              <span class="hive-status status-${h.status}">${statusLabel}</span>
            </div>
            <div class="hive-card-body">
              <div class="hive-stats">
                <div class="hive-stat">
                  <div class="hive-stat-value">ğŸ–¼ï¸ ${h.frames || 0}</div>
                  <div class="hive-stat-label">${t("lbl_frames")}</div>
                </div>
                <div class="hive-stat">
                  <div class="hive-stat-value">ğŸ¯ ${parseFloat(h.honeyTotal || 0).toFixed(1)}kg</div>
                  <div class="hive-stat-label">${t("lbl_honey")}</div>
                </div>
                <div class="hive-stat">
                  <div class="hive-stat-value">ğŸ‘‘ ${h.queenAge || 0}${t("years")}</div>
                  <div class="hive-stat-label">${t("lbl_queen")}</div>
                </div>
                <div class="hive-stat">
                  <div class="hive-stat-value">ğŸ‘¥ ${shortPop(h.population)}</div>
                  <div class="hive-stat-label">${t("lbl_population")}</div>
                </div>
              </div>
            </div>
            <div class="hive-card-footer">
              <span class="hive-date">ğŸ“… ${lastDate}</span>
              <div class="hive-actions" onclick="event.stopPropagation()">
                <button class="icon-btn" title="Edit" onclick="openEditModal('${h.id}')">âœï¸</button>
                <button class="icon-btn" title="Delete" onclick="deleteHive('${h.id}')">ğŸ—‘ï¸</button>
              </div>
            </div>
          </div>`;
      }

      function shortPop(p) {
        if (!p) return "â€”";
        if (lang === "en") {
          const m = { "ScÄƒzutÄƒ":"Low","Medie":"Med","RidicatÄƒ":"High","Foarte RidicatÄƒ":"V.High" };
          return m[p] || p;
        }
        const m = { "ScÄƒzutÄƒ":"Sc.","Medie":"Med","RidicatÄƒ":"Rid.","Foarte RidicatÄƒ":"F.Rid." };
        return m[p] || p;
      }

      // â•â• DETAIL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function openDetail(id) {
        currentHiveId = id;
        historyFilter = "all";
        showView("detail");
      }

      function renderDetail() {
        const h = hives.find(x => x.id === currentHiveId);
        if (!h) return;

        document.getElementById("detail-name").textContent     = h.name;
        document.getElementById("detail-location").textContent = "ğŸ“ " + (h.location || t("unknown"));
        document.getElementById("detail-queen").textContent    =
          `ğŸ‘‘ ${t("lbl_queen")}: ${h.queenType || t("unknown")} Â· ${h.queenAge || 0} ${t("years")}`;

        // Stats
        document.getElementById("detail-stats").innerHTML = `
          <div class="detail-stat"><div class="detail-stat-value">ğŸ–¼ï¸ ${h.frames||0}</div><div class="detail-stat-label">${t("lbl_frames")}</div></div>
          <div class="detail-stat"><div class="detail-stat-value">ğŸ¯ ${h.honeyFrames||0}</div><div class="detail-stat-label">${lang==="ro"?"Rame Miere":"Honey Frames"}</div></div>
          <div class="detail-stat"><div class="detail-stat-value">ğŸ£ ${h.broodFrames||0}</div><div class="detail-stat-label">${lang==="ro"?"Rame Puiet":"Brood Frames"}</div></div>
          <div class="detail-stat"><div class="detail-stat-value">ğŸ¯ ${parseFloat(h.honeyTotal||0).toFixed(1)}kg</div><div class="detail-stat-label">${t("lbl_honey")}</div></div>
          <div class="detail-stat"><div class="detail-stat-value">ğŸ‘¥ ${h.population||"â€”"}</div><div class="detail-stat-label">${t("lbl_population")}</div></div>
        `;

        // Info card
        const statusLabel = { healthy: lang==="ro"?"SÄƒnÄƒtos":"Healthy", attention: lang==="ro"?"NecesitÄƒ AtenÈ›ie":"Needs Attention", critical: lang==="ro"?"Critic":"Critical" }[h.status] || h.status;
        document.getElementById("detail-info").innerHTML = `
          <table style="width:100%;border-collapse:collapse;font-size:0.88rem">
            ${infoRow(t("lbl_location"),  h.location || "â€”")}
            ${infoRow(t("lbl_status"),    statusLabel)}
            ${infoRow(t("lbl_queen"),     `${h.queenAge||0} ${t("years")}`)}
            ${infoRow(t("lbl_queen_type"),h.queenType||"â€”")}
            ${infoRow(t("lbl_population"),h.population||"â€”")}
            ${infoRow(t("lbl_last"),      lastInspDate(h))}
            ${h.notes ? infoRow(t("lbl_notes"), h.notes) : ""}
          </table>`;

        // Mini QR
        renderMiniQR(h);

        // History stats bar
        renderHistoryStats(h);

        // Timeline
        renderTimeline(h);

        // Reset filter buttons
        document.querySelectorAll(".filter-btn").forEach(b => {
          b.classList.toggle("active", b.textContent.trim() === t("filter_all") ||
            (historyFilter !== "all" && b.onclick && b.onclick.toString().includes(`'${historyFilter}'`)));
        });
        // simpler: reset active to first
        document.querySelectorAll(".filter-btn").forEach((b,i) => b.classList.toggle("active", i===0));
      }

      function infoRow(label, value) {
        return `<tr style="border-bottom:1px solid #f5f5f5">
          <td style="padding:0.5rem 0.3rem;color:var(--gray-dark);width:45%">${label}</td>
          <td style="padding:0.5rem 0.3rem;font-weight:600;color:var(--brown)">${value}</td>
        </tr>`;
      }

      function lastInspDate(h) {
        const ev = [...(h.history||[])].filter(e=>e.type==="inspection").pop();
        return ev ? fmtDate(ev.date) : t("never");
      }

      function renderHistoryStats(h) {
        const hist = h.history || [];
        const inspections = hist.filter(e => e.type === "inspection");
        const lastInsp = inspections[inspections.length - 1];
        const honey = lastInsp ? lastInsp.honey || 0 : h.honeyTotal || 0;
        const daysActive = Math.round((Date.now() - h.created) / 86400000);
        document.getElementById("history-stats-bar").innerHTML = `
          <div class="hstat"><div class="hstat-val">${hist.length}</div><div class="hstat-label">${t("hstat_events")}</div></div>
          <div class="hstat"><div class="hstat-val">${inspections.length}</div><div class="hstat-label">${t("hstat_inspections")}</div></div>
          <div class="hstat"><div class="hstat-val">${parseFloat(h.honeyTotal||0).toFixed(1)}</div><div class="hstat-label">${t("hstat_honey")}</div></div>
          <div class="hstat"><div class="hstat-val">${daysActive}</div><div class="hstat-label">${t("hstat_days")}</div></div>
          <div class="hstat"><div class="hstat-val">${lastInspDate(h)}</div><div class="hstat-label">${t("hstat_last")}</div></div>
        `;
      }

      function filterHistory(type, btn) {
        historyFilter = type;
        document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        const h = hives.find(x => x.id === currentHiveId);
        if (h) renderTimeline(h);
      }

      function renderTimeline(h) {
        const hist = [...(h.history || [])].reverse();
        const filtered = historyFilter === "all" ? hist : hist.filter(e => e.type === historyFilter);
        const el = document.getElementById("history-timeline");
        if (filtered.length === 0) {
          el.innerHTML = `<p style="color:var(--gray-dark);padding:1rem 0">${t("no_history")}</p>`;
          return;
        }
        el.innerHTML = filtered.map(ev => timelineItem(ev)).join("");
      }

      function timelineItem(ev) {
        const dotClass  = { created:"dot-created", inspection:"dot-inspection", updated:"dot-updated", critical:"dot-critical" }[ev.type] || "";
        const cardClass = { created:"card-created", inspection:"card-inspection", updated:"card-updated", critical:"card-critical" }[ev.type] || "";
        const icons     = { created:"ğŸŒ±", inspection:"ğŸ”", updated:"âœï¸", critical:"ğŸš¨" };

        let badges = "";
        if (ev.type === "inspection") {
          const items = [];
          if (ev.frames      != null) items.push(`ğŸ–¼ï¸ ${ev.frames} ${lang==="ro"?"rame":"frames"}`);
          if (ev.honeyFrames != null) items.push(`ğŸ¯ ${ev.honeyFrames} ${lang==="ro"?"rame miere":"honey fr."}`);
          if (ev.broodFrames != null) items.push(`ğŸ£ ${ev.broodFrames} ${lang==="ro"?"rame puiet":"brood fr."}`);
          if (ev.honey       != null) items.push(`ğŸ¯ ${ev.honey}kg`);
          if (ev.queen)  items.push(`ğŸ‘‘ ${ev.queen}`);
          if (ev.temper) items.push(`ğŸ˜Š ${ev.temper}`);
          if (ev.varroa) items.push(`ğŸ¦  Varroa: ${ev.varroa}`);
          badges = items.length ? `<div class="timeline-badges">${items.map(i=>`<span class="timeline-badge">${i}</span>`).join("")}</div>` : "";
        }

        return `
          <div class="timeline-item">
            <div class="timeline-dot ${dotClass}">${icons[ev.type]||"ğŸ“Œ"}</div>
            <div class="timeline-card ${cardClass}">
              <div class="timeline-top">
                <span class="timeline-action">${t("ev_" + ev.type)}</span>
                <span class="timeline-date">${fmtDateFull(ev.date)}</span>
              </div>
              ${ev.note ? `<div class="timeline-note">${ev.note}</div>` : ""}
              ${badges}
            </div>
          </div>`;
      }

      // â•â• MINI QR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function renderMiniQR(h) {
        const container = document.getElementById("detail-qr-mini");
        container.innerHTML = "";
        const canvas = document.createElement("canvas");
        container.appendChild(canvas);
        QRCode.toCanvas(canvas, h.id, { width: 120, margin: 1 }, () => {});
      }

      // â•â• ADD / EDIT HIVE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function openAddModal() {
        editingHiveId = null;
        document.getElementById("hive-modal-title").textContent = t("add_hive_title");
        clearHiveForm();
        document.getElementById("hive-modal").classList.add("open");
      }

      function openEditModal(id) {
        editingHiveId = id;
        const h = hives.find(x => x.id === id);
        if (!h) return;
        document.getElementById("hive-modal-title").textContent = t("edit") + ": " + h.name;
        document.getElementById("f-name").value         = h.name || "";
        document.getElementById("f-location").value     = h.location || "";
        document.getElementById("f-status").value       = h.status || "healthy";
        document.getElementById("f-queen-age").value    = h.queenAge || "";
        document.getElementById("f-queen-type").value   = h.queenType || "";
        document.getElementById("f-frames").value       = h.frames || "";
        document.getElementById("f-honey-frames").value = h.honeyFrames || "";
        document.getElementById("f-brood-frames").value = h.broodFrames || "";
        document.getElementById("f-honey").value        = h.honeyTotal || "";
        document.getElementById("f-population").value   = h.population || "Medie";
        document.getElementById("f-notes").value        = h.notes || "";
        document.getElementById("hive-modal").classList.add("open");
      }

      function closeHiveModal() {
        document.getElementById("hive-modal").classList.remove("open");
      }

      function clearHiveForm() {
        ["f-name","f-location","f-queen-age","f-queen-type","f-frames",
         "f-honey-frames","f-brood-frames","f-honey","f-notes"].forEach(id => {
          document.getElementById(id).value = "";
        });
        document.getElementById("f-status").value     = "healthy";
        document.getElementById("f-population").value = "Medie";
      }

      function saveHive() {
        const name = document.getElementById("f-name").value.trim();
        if (!name) return showToast(lang==="ro"?"IntroduceÈ›i un nume!":"Please enter a name.", "error");

        if (editingHiveId) {
          const h = hives.find(x => x.id === editingHiveId);
          if (!h) return;
          h.name        = name;
          h.location    = document.getElementById("f-location").value.trim();
          h.status      = document.getElementById("f-status").value;
          h.queenAge    = parseInt(document.getElementById("f-queen-age").value) || 0;
          h.queenType   = document.getElementById("f-queen-type").value.trim();
          h.frames      = parseInt(document.getElementById("f-frames").value) || 0;
          h.honeyFrames = parseInt(document.getElementById("f-honey-frames").value) || 0;
          h.broodFrames = parseInt(document.getElementById("f-brood-frames").value) || 0;
          h.honeyTotal  = parseFloat(document.getElementById("f-honey").value) || 0;
          h.population  = document.getElementById("f-population").value;
          h.notes       = document.getElementById("f-notes").value.trim();
          h.history = h.history || [];
          h.history.push({ type:"updated", date: Date.now(), note: lang==="ro"?"Date actualizate.":"Data updated." });
          showToast(t("toast_updated"), "success");
        } else {
          const id = "HIVE-" + String(Math.floor(Math.random()*9000)+1000);
          const now = Date.now();
          const h = {
            id, name,
            location    : document.getElementById("f-location").value.trim(),
            status      : document.getElementById("f-status").value,
            queenAge    : parseInt(document.getElementById("f-queen-age").value) || 0,
            queenType   : document.getElementById("f-queen-type").value.trim(),
            frames      : parseInt(document.getElementById("f-frames").value) || 0,
            honeyFrames : parseInt(document.getElementById("f-honey-frames").value) || 0,
            broodFrames : parseInt(document.getElementById("f-brood-frames").value) || 0,
            honeyTotal  : parseFloat(document.getElementById("f-honey").value) || 0,
            population  : document.getElementById("f-population").value,
            notes       : document.getElementById("f-notes").value.trim(),
            created     : now,
            history     : [{ type:"created", date: now, note: lang==="ro"?"Stup Ã®nregistrat Ã®n ApiAgenda.":"Hive registered in ApiAgenda." }]
          };
          hives.push(h);
          showToast(t("toast_added"), "success");
        }

        saveHives();
        closeHiveModal();
        renderHives();
        renderDashboard();
      }

      function deleteHive(id) {
        if (!confirm(t("confirm_delete"))) return;
        hives = hives.filter(h => h.id !== id);
        saveHives();
        renderHives();
        renderDashboard();
        showToast(t("toast_deleted"), "error");
      }

      // â•â• INSPECTION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function openInspectionModal() {
        ["i-frames","i-honey-frames","i-brood-frames","i-honey","i-notes"].forEach(id => {
          document.getElementById(id).value = "";
        });
        document.getElementById("i-queen").value  = "Da";
        document.getElementById("i-temper").value = "Calm";
        document.getElementById("i-status").value = "healthy";
        document.getElementById("i-varroa").value = "Absent";
        document.getElementById("inspection-modal").classList.add("open");
      }

      function closeInspectionModal() {
        document.getElementById("inspection-modal").classList.remove("open");
      }

      function saveInspection() {
        const h = hives.find(x => x.id === currentHiveId);
        if (!h) return;

        const frames      = parseInt(document.getElementById("i-frames").value) || h.frames;
        const honeyFrames = parseInt(document.getElementById("i-honey-frames").value) || h.honeyFrames;
        const broodFrames = parseInt(document.getElementById("i-brood-frames").value) || h.broodFrames;
        const honey       = parseFloat(document.getElementById("i-honey").value) || 0;
        const queen       = document.getElementById("i-queen").value;
        const temper      = document.getElementById("i-temper").value;
        const status      = document.getElementById("i-status").value;
        const varroa      = document.getElementById("i-varroa").value;
        const notes       = document.getElementById("i-notes").value.trim();

        h.frames      = frames;
        h.honeyFrames = honeyFrames;
        h.broodFrames = broodFrames;
        h.honeyTotal  = parseFloat(h.honeyTotal || 0) + honey;
        h.status      = status;

        h.history = h.history || [];
        h.history.push({
          type:"inspection", date: Date.now(),
          frames, honeyFrames, broodFrames, honey,
          queen, temper, status, varroa, note: notes
        });

        saveHives();
        closeInspectionModal();
        renderDetail();
        showToast(t("toast_inspection"), "success");
      }

      // â•â• QR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function openQRModal() {
        const h = hives.find(x => x.id === currentHiveId);
        if (!h) return;
        document.getElementById("qr-hive-name-display").textContent = h.name;
        document.getElementById("qr-hive-id-display").textContent   = h.id;
        QRCode.toCanvas(document.getElementById("qr-canvas"), h.id, { width: 160, margin: 2 }, () => {});
        document.getElementById("qr-modal").classList.add("open");
      }

      function closeQRModal() {
        document.getElementById("qr-modal").classList.remove("open");
      }

      function printQR() {
        const h = hives.find(x => x.id === currentHiveId);
        if (!h) return;
        const canvas = document.getElementById("qr-canvas");
        const dataUrl = canvas.toDataURL();
        document.getElementById("print-label-inner").innerHTML = `
          <div class="p-logo">ğŸ¯ ApiAgenda</div>
          <img src="${dataUrl}" width="160" style="border-radius:8px" />
          <div class="p-name">${h.name}</div>
          <div class="p-id">${h.id}</div>
          <div class="p-hint">${t("scan_hint")}</div>
        `;
        document.getElementById("print-area").style.display = "flex";
        window.print();
        setTimeout(() => { document.getElementById("print-area").style.display = "none"; }, 1000);
      }

      function downloadQR() {
        const h = hives.find(x => x.id === currentHiveId);
        if (!h) return;
        const canvas = document.getElementById("qr-canvas");
        const link   = document.createElement("a");
        link.download = `qr-${h.id}.png`;
        link.href     = canvas.toDataURL();
        link.click();
      }

      // â•â• UTILS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function fmtDate(ts) {
        if (!ts) return "â€”";
        return new Date(ts).toLocaleDateString(lang === "ro" ? "ro-RO" : "en-GB");
      }

      function fmtDateFull(ts) {
        if (!ts) return "â€”";
        return new Date(ts).toLocaleString(lang === "ro" ? "ro-RO" : "en-GB", {
          day:"2-digit", month:"short", year:"numeric", hour:"2-digit", minute:"2-digit"
        });
      }

      function showToast(msg, type = "") {
        const el = document.getElementById("toast");
        el.textContent = msg;
        el.className   = "toast show " + type;
        setTimeout(() => { el.className = "toast"; }, 3000);
      }

      // Close modals on overlay click
      document.querySelectorAll(".modal-overlay").forEach(overlay => {
        overlay.addEventListener("click", e => {
          if (e.target === overlay) overlay.classList.remove("open");
        });
      });

      // â•â• INIT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      (function init() {
        const session = localStorage.getItem("aa_session");
        if (session) {
          try {
            currentUser = JSON.parse(session);
            enterApp();
            return;
          } catch(e) {}
        }
        document.getElementById("auth-screen").style.display = "flex";
        document.getElementById("app-screen").style.display  = "none";
      })();
    </script>
  </body>
  <footer style="text-align: center; padding: 2rem 1rem; color: var(--gray-dark); font-size: 0.9rem; margin-top: 3rem; border-top: 1px solid #e0e0e0;"> Made by <a href="https://linktr.ee/Lelcu" style="color: var(--honey); text-decoration: none; font-weight: 600;">@Lelcu</a>
</html>
